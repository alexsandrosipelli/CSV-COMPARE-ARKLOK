<!-- ... (HTML anterior permanece igual até a tabela de comparação) -->

    <h2 style="margin-top: 60px;">Análise de Logs de Impressora</h2>

    <section>
        <label for="logFile">Arquivo de Log (.txt/.log/.csv):</label>
        <input type="file" id="logFile" accept=".txt,.log,.csv">

        <label for="errorFilter">Filtrar por erro:</label>
        <select id="errorFilter">
            <option value="">Todos</option>
        </select>

        <button onclick="processLog()">Analisar Log</button>
    </section>

    <table id="logTable">
        <thead>
            <tr>
                <th>Data/Hora</th>
                <th>Contagem de Páginas</th>
                <th>Contagem ADF</th>
                <th>Nome do Evento</th>
                <th>Detalhes</th>
            </tr>
        </thead>
        <tbody>
            <!-- Eventos do log -->
        </tbody>
    </table>

<!-- ... footer e scripts -->

<script>
    // Código anterior permanece...

    function processLog() {
        const file = document.getElementById("logFile").files[0];
        if (!file) {
            alert("Por favor, selecione um arquivo de log.");
            return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
            const lines = e.target.result.split(/\r?\n/);
            const events = [];

            let i = 0;
            while (i < lines.length) {
                if (lines[i].match(/^\d{1,2} de /)) {
                    const event = {
                        dataHora: lines[i++].trim(),
                        contagemPaginas: lines[i++]?.trim(),
                        contagemADF: lines[i++]?.trim(),
                        nomeEvento: lines[i++]?.trim(),
                        detalhes: lines[i++]?.trim()
                    };

                    if (event.nomeEvento) {
                        events.push(event);
                    }
                } else {
                    i++;
                }
            }

            displayLogEvents(events);
            populateErrorFilter(events);
        };
        reader.readAsText(file);
    }

    function displayLogEvents(events) {
        const filter = document.getElementById("errorFilter").value.toLowerCase();
        const tbody = document.getElementById("logTable").getElementsByTagName("tbody")[0];
        tbody.innerHTML = "";

        const filtered = events.filter(event => {
            return !filter || event.nomeEvento.toLowerCase().includes(filter);
        });

        if (filtered.length === 0) {
            const tr = document.createElement("tr");
            tr.innerHTML = "<td colspan='5'>Nenhum evento correspondente encontrado.</td>";
            tbody.appendChild(tr);
        } else {
            filtered.forEach(event => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${event.dataHora}</td>
                    <td>${event.contagemPaginas}</td>
                    <td>${event.contagemADF}</td>
                    <td>${event.nomeEvento}</td>
                    <td>${event.detalhes}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    }

    function populateErrorFilter(events) {
        const select = document.getElementById("errorFilter");
        const uniqueErrors = [...new Set(events.map(e => e.nomeEvento))];

        select.innerHTML = `<option value="">Todos</option>`;
        uniqueErrors.forEach(err => {
            const opt = document.createElement("option");
            opt.value = err;
            opt.textContent = err;
            select.appendChild(opt);
        });

        // Reaplica filtro ao trocar seleção
        select.onchange = () => displayLogEvents(events);
    }
</script>
